"use strict";(globalThis.webpackChunk_openmrs_esm_patient_orders_app=globalThis.webpackChunk_openmrs_esm_patient_orders_app||[]).push([[287],{5746:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(272),o=r.n(n),i=r(2609),a=r.n(i)()(o());a.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-orders__order-basket__productiveHeading01___aAMkC{font-size:var(--cds-heading-compact-01-font-size, 0.875rem);font-weight:var(--cds-heading-compact-01-font-weight, 600);line-height:var(--cds-heading-compact-01-line-height, 1.28572);letter-spacing:var(--cds-heading-compact-01-letter-spacing, 0.16px);margin-bottom:.5rem}.-esm-patient-orders__order-basket__productiveHeading02___JR6Pm{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);margin-bottom:1rem}.-esm-patient-orders__order-basket__productiveHeading03___Qul45{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0);margin-bottom:1rem}.-esm-patient-orders__order-basket__productiveHeading04___UPbmi{font-size:var(--cds-heading-04-font-size, 1.75rem);font-weight:var(--cds-heading-04-font-weight, 400);line-height:var(--cds-heading-04-line-height, 1.28572);letter-spacing:var(--cds-heading-04-letter-spacing, 0);margin-bottom:1rem}.-esm-patient-orders__order-basket__productiveHeading05___JQ5Yo{font-size:var(--cds-heading-05-font-size, 2rem);font-weight:var(--cds-heading-05-font-weight, 400);line-height:var(--cds-heading-05-line-height, 1.25);letter-spacing:var(--cds-heading-05-letter-spacing, 0);margin-bottom:1rem}.-esm-patient-orders__order-basket__productiveHeading06___FLzLQ{font-size:var(--cds-heading-06-font-size, 2.625rem);font-weight:var(--cds-heading-06-font-weight, 300);line-height:var(--cds-heading-06-line-height, 1.199);letter-spacing:var(--cds-heading-06-letter-spacing, 0);margin-bottom:1.5rem}.-esm-patient-orders__order-basket__bodyShort01___kBn0A{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-orders__order-basket__bodyShort02___gKL5T{font-size:var(--cds-body-compact-02-font-size, 1rem);font-weight:var(--cds-body-compact-02-font-weight, 400);line-height:var(--cds-body-compact-02-line-height, 1.375);letter-spacing:var(--cds-body-compact-02-letter-spacing, 0)}.-esm-patient-orders__order-basket__bodyLong01___jMGsh{font-size:var(--cds-body-01-font-size, 0.875rem);font-weight:var(--cds-body-01-font-weight, 400);line-height:var(--cds-body-01-line-height, 1.42857);letter-spacing:var(--cds-body-01-letter-spacing, 0.16px)}.-esm-patient-orders__order-basket__bodyLong02___e6XDW{font-size:var(--cds-body-02-font-size, 1rem);font-weight:var(--cds-body-02-font-weight, 400);line-height:var(--cds-body-02-line-height, 1.5);letter-spacing:var(--cds-body-02-letter-spacing, 0)}.-esm-patient-orders__order-basket__label01___k_7MI{font-size:var(--cds-label-01-font-size, 0.75rem);font-weight:var(--cds-label-01-font-weight, 400);line-height:var(--cds-label-01-line-height, 1.33333);letter-spacing:var(--cds-label-01-letter-spacing, 0.32px)}.-esm-patient-orders__order-basket__caption01___htfVm{font-size:var(--cds-legal-01-font-size, 0.75rem);font-weight:var(--cds-legal-01-font-weight, 400);line-height:var(--cds-legal-01-line-height, 1.33333);letter-spacing:var(--cds-legal-01-letter-spacing, 0.32px)}.-esm-patient-orders__order-basket__clipTextWithEllipsis___axdS4{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.-esm-patient-orders__order-basket__text02___SDpzW{color:#525252}.-esm-patient-orders__order-basket__container___XnXp7{display:flex;flex-direction:column;justify-content:space-between;height:var(--desktop-workspace-window-height)}.-esm-patient-orders__order-basket__orderBasketContainer___F8hsg{margin:1rem}.-esm-patient-orders__order-basket__orderBasketContainer___F8hsg .cds--btn-set .cds--btn{max-width:50%;height:4rem}.-esm-patient-orders__order-basket__orderBasketSlot___IyOy9{display:flex;flex-direction:column;gap:2rem}.-esm-patient-orders__order-basket__orderBasketSlotTablet___cT0Ew{gap:1rem}.-esm-patient-orders__order-basket__buttonSet___me45x{padding:0rem}.-esm-patient-orders__order-basket__bottomButton___f2w2K{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-orders__order-basket__inlineNotification___XpH5s,.-esm-patient-orders__order-basket__actionNotification___NsF1Q{max-width:unset !important}.omrs-breakpoint-lt-desktop .-esm-patient-orders__order-basket__container___XnXp7{height:var(--tablet-workspace-window-height)}.omrs-breakpoint-lt-desktop .-esm-patient-orders__order-basket__buttonSet___me45x{padding:1.5rem 1rem;background-color:#fff}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/root.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss","webpack://./src/order-basket/order-basket.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,gEC81BI,2DAAA,CAAA,0DAAA,CAAA,8DAAA,CAAA,mEAAA,CD51BF,mBEeW,CFZb,gECy1BI,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CDv1BF,kBEoBW,CFjBb,gECo1BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CDl1BF,kBEeW,CFZb,gEC+0BI,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CAAA,sDAAA,CD70BF,kBEUW,CFPb,gEC00BI,+CAAA,CAAA,kDAAA,CAAA,mDAAA,CAAA,sDAAA,CDx0BF,kBEKW,CFFb,gECq0BI,mDAAA,CAAA,kDAAA,CAAA,oDAAA,CAAA,sDAAA,CDn0BF,oBEKW,CFFb,wDCg0BI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CD5zBJ,wDC4zBI,oDAAA,CAAA,uDAAA,CAAA,yDAAA,CAAA,2DAAA,CDxzBJ,uDCwzBI,gDAAA,CAAA,+CAAA,CAAA,mDAAA,CAAA,wDAAA,CDpzBJ,uDCozBI,4CAAA,CAAA,+CAAA,CAAA,+CAAA,CAAA,mDAAA,CDhzBJ,oDCgzBI,gDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CD5yBJ,sDC4yBI,gDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CDxyBJ,iEACE,sBAAA,CACA,eAAA,CACA,kBAAA,CAGF,mDACE,aD5DQ,CIFV,sDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,6CAAA,CAGF,iEACE,WDoBW,CCjBb,yFACE,aAAA,CACA,WAAA,CAGF,4DACE,YAAA,CACA,qBAAA,CACA,QAAA,CAGF,kEACE,QAAA,CAGF,sDACE,YAAA,CAGF,yDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,8HACE,0BAAA,CAKA,kFACE,4CAAA,CAGF,kFACE,mBAAA,CACA,qBJpDI",sourceRoot:""}]),a.locals={productiveHeading01:"-esm-patient-orders__order-basket__productiveHeading01___aAMkC",productiveHeading02:"-esm-patient-orders__order-basket__productiveHeading02___JR6Pm",productiveHeading03:"-esm-patient-orders__order-basket__productiveHeading03___Qul45",productiveHeading04:"-esm-patient-orders__order-basket__productiveHeading04___UPbmi",productiveHeading05:"-esm-patient-orders__order-basket__productiveHeading05___JQ5Yo",productiveHeading06:"-esm-patient-orders__order-basket__productiveHeading06___FLzLQ",bodyShort01:"-esm-patient-orders__order-basket__bodyShort01___kBn0A",bodyShort02:"-esm-patient-orders__order-basket__bodyShort02___gKL5T",bodyLong01:"-esm-patient-orders__order-basket__bodyLong01___jMGsh",bodyLong02:"-esm-patient-orders__order-basket__bodyLong02___e6XDW",label01:"-esm-patient-orders__order-basket__label01___k_7MI",caption01:"-esm-patient-orders__order-basket__caption01___htfVm",clipTextWithEllipsis:"-esm-patient-orders__order-basket__clipTextWithEllipsis___axdS4",text02:"-esm-patient-orders__order-basket__text02___SDpzW",container:"-esm-patient-orders__order-basket__container___XnXp7",orderBasketContainer:"-esm-patient-orders__order-basket__orderBasketContainer___F8hsg",orderBasketSlot:"-esm-patient-orders__order-basket__orderBasketSlot___IyOy9",orderBasketSlotTablet:"-esm-patient-orders__order-basket__orderBasketSlotTablet___cT0Ew",buttonSet:"-esm-patient-orders__order-basket__buttonSet___me45x",bottomButton:"-esm-patient-orders__order-basket__bottomButton___f2w2K",inlineNotification:"-esm-patient-orders__order-basket__inlineNotification___XpH5s",actionNotification:"-esm-patient-orders__order-basket__actionNotification___NsF1Q"};const s=a},287:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var n=r(268),o=r.n(n),i=r(2779),a=r.n(i),s=r(4924),d=r(7926),A=r(2870),c=r(2821),l=r(3255);function _(e,t,r,n,o){var i=new Date,a=(0,A.parseDate)(null==r?void 0:r.startDatetime),s=(0,A.parseDate)(null==r?void 0:r.stopDatetime);!r||a<i&&(!s||s>i)||console.warn("createEmptyEncounter received an active visit that is not currently active. This is a programming error. Attempting to place the order using the visit start date.");var d={patient:e,location:n,encounterType:t,encounterDatetime:void 0,visit:null==r?void 0:r.uuid,obs:[]};return(0,A.openmrsFetch)("/ws/rest/v1/encounter",{headers:{"Content-Type":"application/json"},method:"POST",body:d,signal:null==o?void 0:o.signal}).then((function(e){var t;return null==e||null===(t=e.data)||void 0===t?void 0:t.uuid}))}var u=r(321),p=r.n(u),m=r(1195),g=r.n(m),h=r(3275),b=r.n(h),f=r(7162),v=r.n(f),C=r(2094),k=r.n(C),y=r(757),w=r.n(y),D=r(5746),B={};B.styleTagTransform=w(),B.setAttributes=v(),B.insert=b().bind(null,"head"),B.domAPI=g(),B.insertStyleElement=k(),p()(D.Z,B);const E=D.Z&&D.Z.locals?D.Z.locals:void 0;function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function F(e,t,r,n,o,i,a){try{var s=e[i](a),d=s.value}catch(e){return void r(e)}s.done?t(d):Promise.resolve(d).then(n,o)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){F(i,n,o,a,s,"next",e)}function s(e){F(i,n,o,a,s,"throw",e)}a(void 0)}))}}const x=function(e){var t,r,i=e.patientUuid,u=e.closeWorkspace,p=e.closeWorkspaceWithSavedChanges,m=e.promptBeforeClosing,g=(0,s.useTranslation)().t,h="tablet"===(0,A.useLayoutType)(),b=(0,A.useConfig)(),f=(0,A.useSession)(),v=(0,c.useVisitOrOfflineVisit)(i).activeVisit,C=(0,c.useOrderBasket)(),k=C.orders,y=C.clearOrders,w=function(e){var t=(0,c.useSystemVisitSetting)(),r=t.systemVisitEnabled,o=t.isLoadingSystemVisitSetting,i=t.errorFetchingSystemVisitSetting,a=new Date,s="".concat(a.getFullYear(),"-").concat(a.getMonth()+1,"-").concat(a.getDate()),d=(0,l.ZP)(o||r||!e?null:"/ws/rest/v1/encounter?patient=".concat(e,"&fromdate=").concat(s,"&limit=1"),A.openmrsFetch),_=(0,c.useVisitOrOfflineVisit)(e);return(0,n.useMemo)((function(){var e,t,n,a,s,A,c;return o||i?{activeVisitRequired:!1,isLoading:o,error:i,encounterUuid:null,mutate:function(){}}:r?{activeVisitRequired:!0,isLoading:null==_?void 0:_.isLoading,encounterUuid:null==_||null===(n=_.currentVisit)||void 0===n||null===(t=n.encounters)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.uuid,error:null==_?void 0:_.error,mutate:null==_?void 0:_.mutate}:{activeVisitRequired:!1,isLoading:null==d?void 0:d.isLoading,encounterUuid:null==d||null===(c=d.data)||void 0===c||null===(A=c.data)||void 0===A||null===(s=A.results)||void 0===s||null===(a=s[0])||void 0===a?void 0:a.uuid,error:null==d?void 0:d.error,mutate:null==d?void 0:d.mutate}}),[o,i,_,d,r])}(i),D=w.activeVisitRequired,B=w.isLoading,F=w.encounterUuid,x=w.error,T=w.mutate,I=(t=(0,n.useState)(""),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),W=I[0],L=I[1],N=function(e){var t=(0,l.kY)().mutate;return{mutate:(0,n.useCallback)((function(){return t((function(t){return"string"==typeof t&&t.startsWith("/ws/rest/v1/order?patient=".concat(e))}))}),[e,t])}}(i),V=N.mutate;(0,n.useEffect)((function(){m((function(){return!!k.length}))}),[k]);var H,O,P,j=(0,n.useCallback)((function(){var e=(0,A.showModal)("start-visit-dialog",{patientUuid:i,closeModal:function(){return e()}})}),[i]),M=(0,n.useCallback)(z((function(){var e,t,r,n,o;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(a){switch(a.label){case 0:if(e=new AbortController,L(""),t=F)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,_(i,null==b?void 0:b.orderEncounterType,D?v:null,null==f||null===(r=f.sessionLocation)||void 0===r?void 0:r.uuid,e)];case 2:return t=a.sent(),T(),[3,4];case 3:return n=a.sent(),L(n),console.error(n),[2];case 4:return[4,(0,c.postOrders)(t,e)];case 5:return o=a.sent(),y({exceptThoseMatching:function(e){return o.map((function(e){return e.display})).includes(e.display)}}),V(),0==o.length?(p(),function(e,t){var r=t.filter((function(e){return["NEW","RENEW"].includes(e.action)})).map((function(e){return e.display})).join(", "),n=t.filter((function(e){return"REVISE"===e.action})).map((function(e){return e.display})).join(", "),o=t.filter((function(e){return"DISCONTINUE"===e.action})).map((function(e){return e.display})).join(", ");(0,A.showSnackbar)({isLowContrast:!0,kind:"success",title:e("orderCompleted","Placed orders"),subtitle:(r&&"".concat(e("ordered","Placed order for")," ").concat(r,". "))+(n&&"".concat(e("updated","Updated")," ").concat(n,". "))+(o&&"".concat(e("discontinued","Discontinued")," ").concat(o,"."))})}(g,k)):function(e){(0,A.showSnackbar)({isLowContrast:!1,kind:"error",title:e("error","Error"),subtitle:e("errorSavingOrder","There were errors saving some orders.")})}(g),[2,function(){return e.abort()}]}}))})),[v,D,y,p,b,F,T,V,k,i,f,g]),Q=(0,n.useCallback)((function(){u({onWorkspaceClose:y})}),[y,u]);return o().createElement(o().Fragment,null,o().createElement("div",{className:E.container},o().createElement("div",{className:E.orderBasketContainer},o().createElement(A.ExtensionSlot,{className:a()(E.orderBasketSlot,(H={},O=E.orderBasketSlotTablet,P=h,O in H?Object.defineProperty(H,O,{value:P,enumerable:!0,configurable:!0,writable:!0}):H[O]=P,H)),name:"order-basket-slot"})),o().createElement("div",null,(W||x)&&o().createElement(d.K0D,{kind:"error",title:g("errorCreatingAnEncounter","Error when creating an encounter"),subtitle:g("tryReopeningTheWorkspaceAgain","Please try launching the workspace again"),lowContrast:!0,className:E.inlineNotification,inline:!0}),o().createElement(d.uVA,{className:E.buttonSet},o().createElement(d.zxk,{className:E.bottomButton,kind:"secondary",onClick:Q},g("cancel","Cancel")),o().createElement(d.zxk,{className:E.bottomButton,kind:"primary",onClick:M,disabled:!(null==k?void 0:k.length)||B||D&&!v||(null==k?void 0:k.some((function(e){return e.isOrderIncomplete})))},g("signAndClose","Sign and close"))))),D&&!v&&o().createElement(d.FQz,{kind:"error",actionButtonLabel:g("startVisit","Start visit"),onActionButtonClick:j,title:g("startAVisitToRecordOrders","Start a visit to order"),subtitle:g("activeVisitRequired","An active visit is required to make orders"),lowContrast:!0,inline:!0,className:E.actionNotification,hasFocus:!0}))}}}]);